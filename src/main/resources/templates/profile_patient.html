<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <!-- Meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Urinewise - Profile</title>
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="../assets/images/logos/favicon.png" />
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Stylesheets -->
  <link rel="stylesheet" href="../assets/css/styles.min.css" />
  <link rel="stylesheet" href="../assets/css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* Hover effect for editable mode */
    .editable-hover:hover {
      background-color: #f0f0f0;
    }
    .error-message {
      color: red;
      font-size: 12px;
    }
  </style>
</head>
<body>
<div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
     data-sidebar-position="fixed" data-header-position="fixed">
  <aside class="left-sidebar">
    <!-- Sidebar scroll-->
    <div>
      <div class="brand-logo d-flex align-items-center justify-content-between">
        <!-- Logo -->
        <a href="./index.html" class="text-nowrap logo-img">
          <img src="../assets/image/logos/dark-logo.svg" width="180" alt="" />
        </a>
        <!-- Sidebar toggler -->
        <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
          <i class="fas fa-times fs-8"></i>
        </div>
      </div>
      <!-- Sidebar navigation -->
      <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
        <!-- Sidebar items -->
        <ul id="sidebarnav">
          <!-- Home section -->
          <li class="nav-small-cap">
            <i class="fas fa-ellipsis-h nav-small-cap-icon fs-4"></i>
            <span class="hide-menu">Home</span>
          </li>
          <!-- Dashboard -->
          <li class="sidebar-item">
            <a class="sidebar-link" th:href="@{'/Dashboard?patientId=' + ${patientId}}" aria-expanded="false">
              <span><i class="fas fa-columns"></i></span>
              <span class="hide-menu">Dashboard</span>
            </a>
          </li>
          <li class="nav-small-cap">
            <i class="fas fa-ellipsis-h nav-small-cap-icon fs-4"></i>
            <span class="hide-menu">My space</span>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" th:href="@{/profile/{patientId}(patientId=${patientId})}" aria-expanded="false">
              <span><i class="fas fa-user"></i></span>
              <span class="hide-menu">Profile</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" th:href="@{/history/{patientId}(patientId=${patientId})}" aria-expanded="false">
              <span><i class="fas fa-history"></i></span>
              <span class="hide-menu">History</span>
            </a>
          </li>
          <!-- Reports -->
          <li class="sidebar-item">
            <a class="sidebar-link" href="./ui-card.html" aria-expanded="false">
              <span><i class="fas fa-file-medical"></i></span>
              <span class="hide-menu">Reports</span>
            </a>
          </li>
          <!-- Settings -->
          <li class="sidebar-item">
            <a class="sidebar-link" href="./ui-forms.html" aria-expanded="false">
              <span><i class="fas fa-cogs"></i></span>
              <span class="hide-menu">Settings</span>
            </a>
          </li>
          <!-- Authentication section -->
          <li class="nav-small-cap">
            <i class="fas fa-ellipsis-h nav-small-cap-icon fs-4"></i>
            <span class="hide-menu">AUTH</span>
          </li>
          <!-- Sign Out -->
          <li class="sidebar-item">
            <a class="sidebar-link" href="./authentication-login.html" aria-expanded="false">
              <span><i class="fas fa-sign-out-alt"></i></span>
              <span class="hide-menu">Sign Out</span>
            </a>
          </li>
        </ul>
      </nav>
      <!-- End Sidebar navigation -->
    </div>
    <!-- End Sidebar scroll-->
  </aside>
  <div class="body-wrapper">
    <header class="app-header">
      <nav class="navbar navbar-expand-lg navbar-light">
        <ul class="navbar-nav">
          <li class="nav-item d-block d-xl-none">
            <a class="nav-link sidebartoggler nav-icon-hover" id="headerCollapse" href="javascript:void(0)">
              <i class="fas fa-bars"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-icon-hover" href="javascript:void(0)">
              <i class="fas fa-search"></i>
              <div class="notification bg-primary rounded-circle"></div>
            </a>
          </li>
        </ul>
        <div class="navbar-collapse justify-content-end px-0" id="navbarNav">
          <ul class="navbar-nav flex-row ms-auto align-items-center justify-content-end">
          </ul>
        </div>
      </nav>
    </header>
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="card w-100">
            <div class="card-body">
              <h5 class="card-title fw-semibold">Patient Profile</h5>
              <div class="table-responsive" id="profileInfo">
                <table class="table">
                  <tbody>
                  <tr class="editable-hover">
                    <th scope="row">Name</th>
                    <td contenteditable="false" id="name" th:text="${patient.nom}"></td>
                    <td><span class="error-message" id="nameError"></span></td>
                  </tr>
                  <tr class="editable-hover">
                    <th scope="row">First Name</th>
                    <td contenteditable="false" id="firstName" th:text="${patient.prenom}"></td>
                    <td><span class="error-message" id="firstNameError"></span></td>
                  </tr>
                  <tr class="editable-hover">
                    <th scope="row">Birth Date</th>
                    <td contenteditable="false" id="birthDate" th:text="${#dates.format(patient.dateNaissance, 'dd/MM/yyyy')}"></td>
                    <td><span class="error-message" id="birthDateError"></span></td>
                  </tr>
                  <tr class="editable-hover">
                    <th scope="row">Gender</th>
                    <td contenteditable="false" id="gender" th:text="${patient.sexe}"></td>
                  </tr>
                  <tr class="editable-hover">
                    <th scope="row">Email</th>
                    <td contenteditable="false" id="email" th:text="${patient.email}"></td>
                    <td><span class="error-message" id="emailError"></span></td>
                  </tr>
                  <tr>
                    <th scope="row">Phone</th>
                    <td contenteditable="false" id="phone" th:text="${patient.numeroTelephone}"></td>
                    <td><span class="error-message" id="phoneError"></span></td>
                  </tr>
                  <tr>
                    <th scope="row">Address</th>
                    <td contenteditable="false" id="address" th:text="${patient.adresse}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Social Security Number</th>
                    <td contenteditable="false" id="ssn" th:text="${patient.numeroSecuriteSociale}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Health Problems History</th>
                    <td contenteditable="false" id="healthProblems" th:text="${patient.historiqueProblemesSante}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Medical Treatments</th>
                    <td contenteditable="false" id="medicalTreatments" th:text="${patient.traitementsMedicaux}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Current Medications</th>
                    <td contenteditable="false" id="currentMedications" th:text="${patient.medicamentsActuels}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Known Allergies</th>
                    <td contenteditable="false" id="knownAllergies" th:text="${patient.allergiesConnu}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Visit Reason</th>
                    <td contenteditable="false" id="visitReason" th:text="${patient.motifVisite}"></td>
                  </tr>
                  <tr>
                    <th scope="row">Specific Symptoms</th>
                    <td contenteditable="false" id="specificSymptoms" th:text="${patient.symptomesSpecifiques}"></td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="mt-4">
                <a href="javascript:history.back()" class="btn btn-secondary">Back</a>
                <button id="editProfileBtn" class="btn btn-primary">Edit Profile</button>
                <button id="saveChangesBtn" class="btn btn-primary" style="display:none;">Save Changes</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    <script src="../assets/libs/jquery/dist/jquery.min.js"></script>
    <script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/sidebarmenu.js"></script>
    <script src="../assets/js/app.min.js"></script>
    <script src="../assets/libs/simplebar/dist/simplebar.js"></script>
    <script>
      const editProfileBtn = document.getElementById('editProfileBtn');
      const saveChangesBtn = document.getElementById('saveChangesBtn');

      editProfileBtn.addEventListener('click', function() {
        toggleEditing(true); // Set to true to enable editing
      });

      saveChangesBtn.addEventListener('click', function() {
        saveChanges();
        toggleEditing(false);
      });

      // Add input event listeners for real-time validation
      document.getElementById('name').addEventListener('input', validateName);
      document.getElementById('firstName').addEventListener('input', validateFirstName);
      document.getElementById('birthDate').addEventListener('input', validateBirthDate);
      document.getElementById('email').addEventListener('input', validateEmail);
      document.getElementById('phone').addEventListener('input', validatePhone);

      // Function to toggle editing mode
      function toggleEditing(isEditing) {
        const profileInfoElements = document.querySelectorAll('#profileInfo [contenteditable]');
        profileInfoElements.forEach(function(element) {
          // Initially disable editing for all fields
          element.contentEditable = false;
        });

        if (isEditing) {
          const allowedFields = ['name', 'firstName', 'birthDate', 'email', 'phone', 'address'];
          profileInfoElements.forEach(function(element) {
            if (allowedFields.includes(element.id)) {
              element.contentEditable = true; // Enable editing for allowed fields
            }
          });
        }

        // Show/hide buttons based on editing mode
        editProfileBtn.style.display = isEditing ? 'none' : 'inline-block';
        saveChangesBtn.style.display = isEditing ? 'inline-block' : 'none';
      }

      // Validation functions
      function validateName() {
        const nameField = document.getElementById('name');
        const nameError = document.getElementById('nameError');
        const nameRegex = /^[a-zA-Z\s]+$/;

        if (!nameRegex.test(nameField.innerText)) {
          nameError.innerText = 'Please enter a valid name (only alphabets and spaces are allowed).';
        } else {
          nameError.innerText = '';
        }
      }

      function validateFirstName() {
        const firstNameField = document.getElementById('firstName');
        const firstNameError = document.getElementById('firstNameError');
        const nameRegex = /^[a-zA-Z\s]+$/;

        if (!nameRegex.test(firstNameField.innerText)) {
          firstNameError.innerText = 'Please enter a valid first name (only alphabets and spaces are allowed).';
        } else {
          firstNameError.innerText = '';
        }
      }

      function validateBirthDate() {
        const birthDateField = document.getElementById('birthDate');
        const birthDateError = document.getElementById('birthDateError');
        const dateParts = birthDateField.innerText.split('/');

        if (dateParts.length !== 3 || isNaN(dateParts[0]) || isNaN(dateParts[1]) || isNaN(dateParts[2])) {
          birthDateError.innerText = 'Please enter a valid date in the format DD/MM/YYYY.';
        } else {
          const day = parseInt(dateParts[0]);
          const month = parseInt(dateParts[1]);
          const year = parseInt(dateParts[2]);

          if (month < 1 || month > 12 || day < 1 || day > 31) {
            birthDateError.innerText = 'Please enter a valid date.';
          } else {
            birthDateError.innerText = '';
          }
        }
      }

      function validateEmail() {
        const emailField = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailRegex.test(emailField.innerText)) {
          emailError.innerText = 'Please enter a valid email address.';
        } else {
          emailError.innerText = '';
        }
      }

      function validatePhone() {
        const phoneField = document.getElementById('phone');
        const phoneError = document.getElementById('phoneError');
        const phoneRegex = /^\d+$/;

        if (!phoneRegex.test(phoneField.innerText)) {
          phoneError.innerText = 'Please enter digits only.';
        } else {
          phoneError.innerText = '';
        }
      }

      // Function to save changes
      function saveChanges() {
        // Get updated profile information
        const updatedName = document.getElementById('name').innerText.trim();
        const updatedEmail = document.getElementById('email').innerText.trim();
        const updatedFirstName = document.getElementById('firstName').innerText.trim();
        const updatedBirthDate = document.getElementById('birthDate').innerText.trim();
        const updatedGender = document.getElementById('gender').innerText.trim();
        const updatedPhone = document.getElementById('phone').innerText.trim();
        const updatedAddress = document.getElementById('address').innerText.trim();
        const updatedSSN = document.getElementById('ssn').innerText.trim();
        const updatedHealthProblems = document.getElementById('healthProblems').innerText.trim();
        const updatedMedicalTreatments = document.getElementById('medicalTreatments').innerText.trim();
        const updatedCurrentMedications = document.getElementById('currentMedications').innerText.trim();
        const updatedKnownAllergies = document.getElementById('knownAllergies').innerText.trim();
        const updatedVisitReason = document.getElementById('visitReason').innerText.trim();
        const updatedSpecificSymptoms = document.getElementById('specificSymptoms').innerText.trim();

        // Validate email format
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(updatedEmail)) {
          document.getElementById('emailError').innerText = 'Please enter a valid email address.';
          return;
        } else {
          document.getElementById('emailError').innerText = ''; // Clear error message
        }

        // Validate birth date
        const dateParts = updatedBirthDate.split('/');
        if (dateParts.length !== 3 || isNaN(dateParts[0]) || isNaN(dateParts[1]) || isNaN(dateParts[2])) {
          document.getElementById('birthDateError').innerText = 'Please enter a valid date in the format DD/MM/YYYY.';
          return;
        }
        const day = parseInt(dateParts[0]);
        const month = parseInt(dateParts[1]);
        const year = parseInt(dateParts[2]);
        if (month < 1 || month > 12 || day < 1 || day > 31 || year < 1900 || year > 2024) {
          document.getElementById('birthDateError').innerText = 'Please enter a valid date.';
          return;
        } else {
          document.getElementById('birthDateError').innerText = ''; // Clear error message
        }

        // Validate phone number format (exactly 10 digits)
        const phoneRegex = /^\d{10}$/;
        if (!phoneRegex.test(updatedPhone)) {
          document.getElementById('phoneError').innerText = 'Please enter a valid 10-digit phone number.';
          return;
        } else {
          document.getElementById('phoneError').innerText = ''; // Clear error message
        }

        // Validate name format (only alphabets and spaces allowed)
        const nameRegex = /^[a-zA-Z\s]+$/;
        if (!nameRegex.test(updatedName)) {
          document.getElementById('nameError').innerText = 'Please enter a valid name (only alphabets and spaces are allowed).';
          return;
        } else {
          document.getElementById('nameError').innerText = ''; // Clear error message
        }

        // Validate first name format (only alphabets and spaces allowed)
        if (!nameRegex.test(updatedFirstName)) {
          document.getElementById('firstNameError').innerText = 'Please enter a valid first name (only alphabets and spaces are allowed).';
          return;
        } else {
          document.getElementById('firstNameError').innerText = ''; // Clear error message
        }

        // Function to save changes
        function saveChanges() {
          // Get updated profile information
          const updatedName = document.getElementById('name').innerText.trim();
          const updatedEmail = document.getElementById('email').innerText.trim();
          const updatedFirstName = document.getElementById('firstName').innerText.trim();
          const updatedBirthDate = document.getElementById('birthDate').innerText.trim();
          const updatedGender = document.getElementById('gender').innerText.trim();
          const updatedPhone = document.getElementById('phone').innerText.trim();
          const updatedAddress = document.getElementById('address').innerText.trim();
          const updatedSSN = document.getElementById('ssn').innerText.trim();
          const updatedHealthProblems = document.getElementById('healthProblems').innerText.trim();
          const updatedMedicalTreatments = document.getElementById('medicalTreatments').innerText.trim();
          const updatedCurrentMedications = document.getElementById('currentMedications').innerText.trim();
          const updatedKnownAllergies = document.getElementById('knownAllergies').innerText.trim();
          const updatedVisitReason = document.getElementById('visitReason').innerText.trim();
          const updatedSpecificSymptoms = document.getElementById('specificSymptoms').innerText.trim();

          // Here you can send the updated data to the server using AJAX or perform other actions

          // For demonstration purposes, let's just log the updated data
          console.log('Updated Name:', updatedName);
          console.log('Updated Email:', updatedEmail);
          console.log('Updated First Name:', updatedFirstName);
          console.log('Updated Birth Date:', updatedBirthDate);
          console.log('Updated Gender:', updatedGender);
          console.log('Updated Phone:', updatedPhone);
          console.log('Updated Address:', updatedAddress);
          console.log('Updated SSN:', updatedSSN);
          console.log('Updated Health Problems:', updatedHealthProblems);
          console.log('Updated Medical Treatments:', updatedMedicalTreatments);
          console.log('Updated Current Medications:', updatedCurrentMedications);
          console.log('Updated Known Allergies:', updatedKnownAllergies);
          console.log('Updated Visit Reason:', updatedVisitReason);
          console.log('Updated Specific Symptoms:', updatedSpecificSymptoms);

          // Optionally, you can provide feedback to the user that changes have been saved
          alert('Changes saved successfully!');
        }}
    </script>
  </div>
</div>
</body>
</html>
